<html>
  <head>
    <title>Geo-locater</title>
    <meta name = "viewport" content = "width = device-width" />
<link href='http://fonts.googleapis.com/css?family=Reenie+Beanie' rel='stylesheet' type='text/css'>
<style>
h1,h2,h3 { font-family: 'Reenie Beanie', arial, serif; }
h3 { font-size: 24pt;}
h3 {margin-height: 0px; padding-height: 0px;}
</style>
    <style type="text/css">
      html, body, #map { height: 100%; margin: 0; }
    </style>
    <script
      src="https://maps.googleapis.com/maps/api/js?libraries=drawing&sensor=false"
      type="text/javascript"></script>
        <script src="output.json" type="text/javascript"></script>
<!--
    <script
       src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAhe6A1R99SP0ZrzrGWvxAGhQ-HP9w2GiAj3fY8FJaHBdkABCGxxQUUoGVdJQVwot2UGMiBOnQQAatCA"
       type="text/javascript"></script> -->
       <script type="text/javascript">
      var map_location = new google.maps.LatLng(0, 0);
      var marker;
      var map;
      var markers = [];
      var oldest_marker = 1;
      var max_markers = 100;

      function createMarker(point, label, html) {
      var mark1 = new google.maps.Marker({
		position: point,
		draggable: false,
		map: map
		});
	var infowindow = new google.maps.InfoWindow({
		content: "<div align='left'><strong>" + label + "</strong><br/>" + html + "</div>"
		});
      //mark1.bouncy = true;
      google.maps.event.addListener(mark1, "click",
      function() {
      map_location = mark1.position;
      map.panTo(map_location);
      var a = "";
	infowindow.open(map, mark1);
      }
      );
      return mark1;
      }

      function textFor(element, tag) {
      return element.getElementsByTagName(tag)[0].firstChild.nodeValue;
      }

      function setAMarker(point) {
      if (point) {
      var lat = point.latitude;
      if ((lat < -90) || (lat > 90)) {
        alert("Invalid latitude: '" + lat + "'");
        return;
      }
      var lng = point.longitude;
      if ((lng < -90) || (lng > 90)) {
        alert("Invalid longitude: '" + lng + "'");
        return;
      }
      lat = lat + ((Math.random() - 0.5) /  100000000000.0);
      lng = lng + ((Math.random() - 0.5) /  100000000000.0);
      var html = point.info;
      var label = "[" + point.latitude + ", " + point.longitude + "]";
      point = new google.maps.LatLng(lat, lng);
      var marker = createMarker(point,label,html);
      marker.setMap(map);
      var next_marker = oldest_marker - 1;
      if (next_marker < 0) {
                        next_marker = max_markers - 1;
                        }
                        markers[next_marker] = marker;
                        }
                        }

                        function loadData(url) {
                            var points = data;
			map.center = new google.maps.LatLng(points[Math.round(points.length/2)].latitude,points[Math.round(points.length/2)].longitude);
			map.zoom = 16;
                            for (var i = 0; i < points.length; i++) {
                                setAMarker(points[i]);
                            }
                        }

                                            var last_request = 0;
                                            var dataFile;

                                            function initialize() {
                                            map = new google.maps.Map(document.getElementById("map"), {
										center: map_location,
										zoom: 2,
										mapTypeId: google.maps.MapTypeId.HYBRID
										});
                                            var orig_query  = window.location.search;
                                            if ((orig_query != null) && (orig_query.length > 0)) {
                        orig_query = orig_query.substring(1);
                        query = unescape(orig_query);
                        var geocoder = new google.maps.Geocoder();
                        geocoder.getLatLng(
                        query,
                        function(point) {
                        if (point) {
                        map.center = new google.maps.LatLng(point.latitude, point.longitude);
                        map.zoom = 13;
                        onMapMove();
                        }
                        }
                        );
                        }
                        loadData(dataFile);
                        } 
			google.maps.event.addDomListener(window, 'load', initialize);
</script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
